### mysql 搜索引擎



索引：Mysql官方对索引的定位为：索引是帮助Mysql高效获取数据的数据结构，可以得到索引的本质就是，索引是数据结构。

可以简单的理解为：排好序的快速查找B+树数据结构，B+树中的B代表平衡(balance) 而不是 二叉（binary）

### 聚簇索引和非聚簇索引

- 聚簇索引：将数据存储与索引放到一块，索引结构的叶子节点保存了行数据
- 非聚簇索引：将数据与索引分开，索引结构的叶子节点指向了数据对应的位置



在InnoDB中，在聚簇索引之上创建的索引被称为辅助索引，非聚簇索引都是辅助索引，像复合索引，前缀索引，唯一索引。

辅助索引叶子节点存储不再是行的物理位置，而是主键值，辅助索引访问数据总是需要二次查找，这个就被称为 回表操作

![image-20200723105915972](http://note.moguit.cn/%E6%A0%A1%E6%8B%9B%E9%9D%A2%E8%AF%95/%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98/4_MySQL%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/images/image-20200723105915972.png)

### 索引优点

最典型的例子就是查新华字典，通过查找目录快速定位到查找的字

- 大大减少了服务器需要扫描的数量
- 帮助服务器避免排序和临时表
- 将IO变成顺序IO
  - 尽可能的降低磁盘的寻址时间，也就是局部性原理，就是很大一部分数据在未来的一段时间被连续访问
  - 在复制1G压缩包 和 1G小文件，前者的速度会大于后者
  - 减少IO的量，例如写SQL语句的时候，不要写 select *
  - 减少IO的次数，一次IO能搞定的事，不使用3次IO





数据库事务特点
ACID： 原子性，一致性，隔离性，永久性

Q：数据库事务说是如何实现的?

（1）：通过预写日志方式实现的，redo和undo机制是数据库实现事务的基础

（2）：redo日志用来在断电/数据库崩溃等状况发生时重演一次刷数据的过程，把redo日志里的数据刷到数据库里，保证了事务 的持久性（Durability）

（3）：undo日志是在事务执行失败的时候撤销对数据库的操作，保证了事务的原子性



事务级别4种：

1.读未提交  read-uncommited

2.不可重复读 read-commited

3.可重复读 repeatable-read

4.串行化 serializable 





```
索引哪些情况会失效？
1.模糊查询尽量要左模糊 ‘a%’
2.索引字段尽量不要有函数计算等
3.当做范围查询是所有会根据条件查询，反之当做非查询时候不会走索引，有<> not  in  exisit等
4.查询的值跟索引字段类型有隐私转换时候如：id ='123'
```

```
MySQL中有哪几种锁，列举一下？
1、表级锁：开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。

2、行级锁：开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。

3、页面锁：开销和加锁时间界于表锁和行锁之间；会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般。
```



```
谈下你对mysql索引的了解？
1.mysql选这的是B+tree作为索引，为什么选这B+tree?
2.在叶子节点一层，所有记录的主键按照从小到大的顺序排 列，并且形成了一个双向链表。叶子节点的每一个Key指向一条记录。
3.非叶子节点取的是叶子节点里面Key的最小值。这意味着所有 非叶子节点的Key都是冗余的叶子节点。同一层的非叶子节点也互相串 联，形成了一个双向链表。
4.天然的支持分页、排序等
```



# **什么是MVCC**？

**Multiversion concurrency control**，多版本并发控制，提供并发访问数据库时，对事务内读取的到的内存做处理，用来避免写操作堵塞读操作的并发问题。

解决了在无锁话的情况下，解决了读写的并发问题。

undo.log 文件 提供了数据的版本链

read_view ：判断出当前事务在版本链中获取到的数据版本



